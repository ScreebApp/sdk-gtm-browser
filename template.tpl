___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Screeb",
  "categories": ["ANALYTICS", "DATA_WAREHOUSING", "EXPERIMENTATION", "SURVEY", "PERSONALIZATION", "HEAT_MAP", "SESSION_RECORDING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "In-app surveys and product analytics.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "command",
    "displayName": "Action",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "init",
        "displayValue": "Tag initialization"
      },
      {
        "value": "close",
        "displayValue": "Close tag"
      },
      {
        "value": "identity",
        "displayValue": "Change identity"
      },
      {
        "value": "identity.properties",
        "displayValue": "Set identity properties"
      },
      {
        "value": "identity.group.assign",
        "displayValue": "Assign segment"
      },
      {
        "value": "identity.group.unassign",
        "displayValue": "Unassign segment"
      },
      {
        "value": "identity.reset",
        "displayValue": "Reset identity"
      },
      {
        "value": "event.track",
        "displayValue": "Track event"
      },
      {
        "value": "survey.start",
        "displayValue": "Start survey"
      },
      {
        "value": "survey.close",
        "displayValue": "Close current survey"
      },
      {
        "value": "debug",
        "displayValue": "Print debug in console"
      },
      {
        "value": "targeting.debug",
        "displayValue": "Print targeting engine status in console"
      }
    ],
    "simpleValueType": true,
    "alwaysInSummary": true,
    "defaultValue": "init",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "init__channel_id",
    "displayName": "Website ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$"
        ]
      },
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "init__identity",
    "displayName": "User ID",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "PARAM_TABLE",
    "name": "init__identity_properties",
    "displayName": "User properties",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "key",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "value",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "newRowButtonText": "Add property",
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "identity__identity",
    "displayName": "User ID",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "identity",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "PARAM_TABLE",
    "name": "identity__properties",
    "displayName": "User properties",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "key",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "value",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "newRowButtonText": "Add property",
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "identity",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "PARAM_TABLE",
    "name": "identity_properties__properties",
    "displayName": "User properties",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "key",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "value",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "newRowButtonText": "Add property",
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "identity.properties",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "identity_group_assign__group_type",
    "displayName": "Group type",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "identity.group.assign",
        "type": "EQUALS"
      }
    ],
    "valueHint": "Eg: default, cohort, company..."
  },
  {
    "type": "TEXT",
    "name": "identity_group_assign__group_name",
    "displayName": "Group name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "identity.group.assign",
        "type": "EQUALS"
      }
    ],
    "valueHint": "Eg: \"cohort week-42\", \"apple\", \"paying\"",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "PARAM_TABLE",
    "name": "identity_group_assign__properties",
    "displayName": "Group properties",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "key",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "value",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "newRowButtonText": "Add property",
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "identity.group.assign",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "identity_group_unassign__group_type",
    "displayName": "Group type",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "identity.group.unassign",
        "type": "EQUALS"
      }
    ],
    "valueHint": "Eg: default, cohort, company..."
  },
  {
    "type": "TEXT",
    "name": "identity_group_unassign__group_name",
    "displayName": "Group name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "identity.group.unassign",
        "type": "EQUALS"
      }
    ],
    "valueHint": "Eg: \"cohort week-42\", \"apple\", \"paying\"",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "event_track__name",
    "displayName": "Event name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "event.track",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "PARAM_TABLE",
    "name": "event_track__properties",
    "displayName": "Event properties",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "key",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "value",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "newRowButtonText": "Add property",
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "event.track",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "survey_start__survey_id",
    "displayName": "Survey ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$"
        ]
      },
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "survey.start",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "survey_start__allow_multiple_responses",
    "checkboxText": "Allow multiple responses",
    "simpleValueType": true,
    "defaultValue": true,
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "survey.start",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "PARAM_TABLE",
    "name": "survey_start__hidden_fields",
    "displayName": "Hidden fields",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "key",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "value",
          "displayName": "",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "newRowButtonText": "Add hidden field",
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "survey.start",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

//
// It's not possible to inject the tag like anywhere in the web, because GTM adds a sandbox.
// Then, we need to remotely control window object and inject commands into a queue controlled by GTM.
//

const injectScript = require('injectScript');
const log = require('logToConsole');
const createArgumentsQueue = require('createArgumentsQueue');
const callInWindow = require('callInWindow');

const url = 'https://t.screeb.app/tag.js';

// ScreebObject is not supported here, then the tag will fallback on '$screeb' by default.
const screeb = createArgumentsQueue('$screeb', '$screeb.q');

function adaptPropertyFieldToKV(givenProperties) {
  if (!givenProperties) {
    return {};
  }

  let properties = {};
  for (let i = 0; i < givenProperties.length; i++) {
    const key = givenProperties[i].key;
    const value = givenProperties[i].value;  // always of type string ?
    properties[key] = value;
  }
  return properties;
}

log("input data:", data);

switch (data.command) {
  case "init":
    const initChannelId = data.init__channel_id;
    const initIdentity = data.init__identity ? data.init__identity : null;
    const initProperties = adaptPropertyFieldToKV(data.init__identity_properties);
    const initSettings = {identity:{id: initIdentity, properties: initProperties}};
    screeb('init', initChannelId, initSettings);
    log('command:', 'init', initChannelId, initSettings);

    injectScript(url, data.gtmOnSuccess(), data.gtmOnFailure(), url);
    break;

  case "close":
    screeb('close');
    log('command:', 'close');
    break;

  case "identity":
    const identityIdentity = data.identity__identity ? data.identity__identity : null;
    const identityProperties = adaptPropertyFieldToKV(data.identity__properties);
    screeb('identity', identityIdentity, identityProperties);
    log('command:', 'identity', identityIdentity, identityProperties);
    break;

  case "identity.properties":
    const identityPropertiesProperties = adaptPropertyFieldToKV(data.identity_properties__properties);
    screeb('identity.properties', identityPropertiesProperties);
    log('command:', 'identity.properties', identityPropertiesProperties);
    break;

  case "identity.group.assign":
    const identityGroupAssignType = data.identity_group_assign__group_type ? data.identity_group_assign__group_type : null;
    const identityGroupAssignName = data.identity_group_assign__group_name;
    const identityGroupAssignProperties = adaptPropertyFieldToKV(data.identity_group_assign__properties);
    screeb('identity.group.assign', identityGroupAssignType, identityGroupAssignName, identityGroupAssignProperties);
    log('command:', 'identity.group.assign', identityGroupAssignType, identityGroupAssignName, identityGroupAssignProperties);
    break;

  case "identity.group.unassign":
    const identityGroupUnassignType = data.identity_group_unassign__group_type ? data.identity_group_unassign__group_type : null;
    const identityGroupUnassignName = data.identity_group_unassign__group_name;
    screeb('identity.group.unassign', identityGroupUnassignType, identityGroupUnassignName);
    log('command:', 'identity.group.unassign', identityGroupUnassignType, identityGroupUnassignName);
    break;

  case "identity.reset":
    screeb('identity.reset');
    log('command:', 'identity.reset');
    break;

  case "event.track":
    const eventTrackName = data.event_track__name;
    const eventTrackProperties = adaptPropertyFieldToKV(data.event_track__properties);
    screeb('event.track', eventTrackName, eventTrackProperties);
    log('command:', 'event.track', eventTrackName, eventTrackProperties);
    break;

  case "survey.start":
    const surveyStartSurveyId = data.survey_start__survey_id;
    const surveyStartAllowMultipleResponses = data.survey_start__allow_multiple_responses === "true";
    const surveyStartHiddenFields = adaptPropertyFieldToKV(data.survey_start__hidden_fields);
    const surveyStartSettings = {allow_multiple_responses :surveyStartAllowMultipleResponses, hidden_fields: surveyStartHiddenFields};
    screeb('survey.start', surveyStartSurveyId, surveyStartSettings);
    log('command:', 'survey.start', surveyStartSurveyId, surveyStartSettings);
    break;

  case "survey.close":
    screeb('survey.close');
    log('command:', 'survey.close');
    break;

  case "debug":
    screeb('debug');
    log('command:', 'debug');
    break;

  case "targeting.debug":
    screeb('targeting.debug');
    log('command:', 'targeting.debug');
    break;
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "$screeb"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "$screeb.q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://t.screeb.app/tag.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 21/09/2023, 16:42:24


